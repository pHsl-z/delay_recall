# 月托学生使用说明

## 概述
月托学生是指按月缴费的托管学生，采用自然日计算方式，费用按月结算，支持灵活的续费提醒和状态管理。

## 基本特征

### 1. 学生类型标识
- **类型名称**: 月托
- **数据库字段**: `student_type = '月托'`
- **默认样式**: `bg-green-100 text-green-800` (绿色背景，绿色文字)
- **图标标识**: 使用绿色主题色彩区分

### 2. 费用结构
- **默认月费**: 1000元/月
- **费用字段**: `monthly_payment` (存储月托费用金额)
- **快捷选项**: 800元、1000元、1200元
- **自定义支持**: 支持输入任意月托费用金额
- **预付费模式**: 采用预付费模式，需提前缴纳整月费用

### 3. 日期计算机制
- **计算方式**: 按自然日计算 (包含周末和节假日)
- **延期函数**: `calculateExtensionDate()` 中使用 `getExtendedDate()`
- **续费日期**: `next_renewal_date` 字段存储下次续费日期
- **入学日期**: 等同首次缴费日期，变更将同步影响下月缴费日期

## 核心功能逻辑

### 1. 续费提醒系统

#### 提醒配置
```javascript
// 默认设置
enableMonthlyRenewal: true,      // 启用月缴续费提醒
renewalReminderDays: 7,          // 提前提醒天数 (0/3/7天可选)
renewalCalculationMethod: 'rolling'  // 滚动计算方式
```

#### 提醒规则
- **已过期**: 显示红色警告，标注过期天数
- **今日到期**: 显示红色提醒"今日应续费"
- **3天内**: 显示橙色提醒，标注剩余天数
- **7天内**: 显示蓝色提醒，标注剩余天数
- **正常状态**: 显示距离续费日期天数

#### 提醒界面
- **位置**: 仪表盘首页"月缴续费提醒"专区
- **显示内容**: 学生姓名、续费日期、剩余天数、年级、电话
- **交互功能**: 点击学生条目可查看详细信息
- **实时更新**: 支持设置变更后实时刷新提醒列表

### 2. 费用处理原则
- **按月结算**: 每月缴费一次，按自然月计算
- **预付费模式**: 采用预付费模式，需提前缴纳整月费用
- **不支持退费**: 暂停后剩余费用不退还
- **续费机制**: 到期前系统提醒续费

### 3. 状态管理

#### 学生状态
- **active**: 在读状态，正常参与托管
- **suspended**: 暂停状态，不参与托管活动
- **inactive**: 非活跃状态，已停止托管

#### 自动暂停机制
- **触发条件**: 过了缴费期限且状态为在读
- **执行方式**: 系统自动检查，每小时执行一次
- **暂停操作**: 更新学生状态为 suspended
- **记录处理**: 停用相关缴费记录
- **通知提醒**: 显示暂停通知给用户

### 4. 录入与编辑

#### 学生录入
- **必填字段**: 姓名、年级、班级、联系方式
- **费用设置**: 选择月托类型后显示费用设置区域
- **快捷金额**: 提供800/1000/1200元快捷按钮
- **自定义输入**: 支持输入任意月托费用金额
- **入学日期**: 设置入学日期，同步首次缴费日期

#### 批量导入
- **模板支持**: 提供Excel导入模板
- **字段映射**: 姓名、年级、班级、学校、家长、联系方式、缴费日期、续费日期、缴费金额
- **错误处理**: 显示导入成功/失败数量和详细错误信息

## 界面展示

### 1. 学生列表展示
- **类型标识**: 绿色标签显示"月托"
- **费用显示**: 显示月托费用金额
- **续费日期**: 显示下次续费日期
- **状态样式**: 根据状态显示不同颜色标识

### 2. 费用设置界面
```html
<!-- 月托费用设置区域 -->
<div className="bg-green-50 border border-green-200 rounded-lg p-4">
    <h4 className="text-green-800 font-medium mb-3">月托费用设置</h4>
    <div className="flex gap-2 mb-3">
        <button className="px-3 py-1 bg-green-100 text-green-800 rounded">800元</button>
        <button className="px-3 py-1 bg-green-500 text-white rounded">1000元</button>
        <button className="px-3 py-1 bg-green-100 text-green-800 rounded">1200元</button>
    </div>
    <input type="number" placeholder="自定义月托费用" className="w-full px-3 py-2 border border-green-300 rounded" />
</div>
```

### 3. 续费提醒组件
- **标题**: "月缴续费提醒"
- **开关控制**: 0天(已过期)/3天/7天 可选
- **列表展示**: 卡片式布局，显示学生信息和续费状态
- **空状态**: 暂无即将到期续费时显示友好提示

## 系统配置

### 1. 设置选项
- **启用月缴续费提醒**: 默认开启
- **提前提醒天数**: 支持0天、3天、7天可选
- **滚动计算方式**: 默认采用滚动计算

### 2. 数据存储
- **本地存储**: 使用localStorage存储设置
- **设置键名**: `systemSettings`
- **同步机制**: 支持多标签页同步和事件通知

## 注意事项

### 1. 使用限制
- **浏览器依赖**: 设置数据存储在浏览器本地
- **数据清除**: 清除浏览器数据会丢失设置
- **网络要求**: 需要网络连接才能正常使用提醒功能

### 2. 操作建议
- **定期备份**: 建议定期备份重要配置信息
- **设置保存**: 修改设置后需要点击"保存设置"按钮
- **默认恢复**: 支持重置为默认设置，但会清除自定义配置

### 3. 业务规则
- **预付费模式**: 月托采用预付费模式，需提前缴纳费用
- **不退费原则**: 暂停后剩余费用不退还
- **自然日计算**: 按自然日计算，包含周末和节假日
- **续费提醒**: 系统会在到期前提醒续费，避免服务中断

## 常见问题

### Q: 月托和日托的主要区别是什么？
A: 月托按自然月计算费用，包含周末和节假日；日托按工作日计算，排除周末和节假日。月托费用按月结算，日托按实际天数结算。

### Q: 月托费用可以自定义吗？
A: 可以，系统提供800/1000/1200元快捷选项，也支持输入任意自定义金额。

### Q: 续费提醒可以关闭吗？
A: 可以在系统设置中关闭月缴续费提醒功能，关闭后将不再显示续费提醒。

### Q: 月托学生暂停后费用如何处理？
A: 按照系统规则，月托学生暂停后剩余费用不退还，建议在暂停前合理安排续费时间。