# 学期学生使用说明

## 概述
学期学生是指按学期缴费的托管学生，采用自然日计算方式，费用按学期一次性缴纳，支持灵活的学期日期设置和续费提醒功能。

## 基本特征

### 1. 学生类型标识
- **类型名称**: 学期
- **数据库字段**: `student_type = '学期'`
- **视觉标识**: 紫色标签显示，文字为"学期"
- **图标标识**: 使用紫色主题色彩区分
- **默认样式**: `bg-purple-100 text-purple-800` (紫色背景，紫色文字)

### 2. 费用结构
- **默认学期费**: 3800元/学期
- **快捷选项**: 3800元、4200元、4800元
- **自定义支持**: 支持输入任意学期费用金额
- **费用字段**: `monthly_payment` (存储学期费用金额)
- **预付费模式**: 采用预付费模式，需提前缴纳整学期费用

### 3. 日期计算机制
- **计算方式**: 按自然日计算 (包含周末和节假日)
- **延期函数**: `calculateNextRenewalDate()` 计算续费日期
- **续费日期**: `next_renewal_date` 字段存储下次续费日期
- **学期日期**: 支持自定义学期开始和结束日期
- **滚动计算**: 默认采用滚动计算方式

## 核心功能逻辑

### 1. 学期日期管理

#### 日期设置
```javascript
// 学期开始日期：学生入学日期
registration_date: "2025-02-17"

// 学期结束日期：本学期最后一天
next_renewal_date: "2025-07-15"
```

#### 自动续费计算
```javascript
const calculateNextRenewalDate = (fromDate) => {
    const date = new Date(fromDate);
    const currentDay = date.getDate();
    const currentMonth = date.getMonth();
    const currentYear = date.getFullYear();
    
    // 计算下个月
    let nextMonth = currentMonth + 1;
    let nextYear = currentYear;
    
    if (nextMonth > 11) {
        nextMonth = 0;
        nextYear += 1;
    }
    
    // 获取下月的天数
    const daysInNextMonth = new Date(nextYear, nextMonth + 1, 0).getDate();
    
    // 处理特殊情况：如果当前日期是31号，而下月不足31天，则使用下月的最后一天
    let nextMonthDay;
    if (currentDay === 31 && daysInNextMonth < 31) {
        nextMonthDay = daysInNextMonth; // 使用下月的最后一天
    } else {
        nextMonthDay = Math.min(currentDay, daysInNextMonth); // 使用较小的值
    }
    
    // 设置下月缴费日期
    const nextDate = new Date(nextYear, nextMonth, nextMonthDay);
    return nextDate.toISOString().split('T')[0];
};
```

### 2. 续费提醒系统

#### 提醒配置
```javascript
// 默认设置
enableMonthlyRenewal: true,      // 启用续费提醒
renewalReminderDays: 7,          // 提前提醒天数 (0/3/7天可选)
renewalCalculationMethod: 'rolling'  // 滚动计算方式
```

#### 提醒规则
- **已过期**: 显示红色警告，标注过期天数
- **今日到期**: 显示红色提醒"今日应续费"
- **3天内**: 显示橙色提醒，标注剩余天数
- **7天内**: 显示蓝色提醒，标注剩余天数
- **正常状态**: 显示距离续费日期天数

#### 提醒界面
- **位置**: 仪表盘首页"续费提醒"专区
- **显示内容**: 学生姓名、续费日期、剩余天数、年级、电话
- **交互功能**: 点击学生条目可查看详细信息
- **实时更新**: 支持设置变更后实时刷新提醒列表

### 3. 费用处理原则
- **按学期结算**: 每学期缴费一次，按自然学期计算
- **预付费模式**: 采用预付费模式，需提前缴纳整学期费用
- **不支持退费**: 暂停后剩余费用不退还
- **续费机制**: 到期前系统提醒续费

### 4. 状态管理

#### 学生状态
- **active**: 在读状态，正常参与托管
- **suspended**: 暂停状态，不参与托管活动
- **inactive**: 非活跃状态，已停止托管

#### 自动暂停机制
- **触发条件**: 过了缴费期限且状态为在读
- **执行方式**: 系统自动检查，每小时执行一次
- **暂停操作**: 更新学生状态为 suspended
- **记录处理**: 停用相关缴费记录
- **通知提醒**: 显示暂停通知给用户

## 界面展示

### 1. 学期托管设置界面
```html
<!-- 学期托管设置区域 -->
<div className="bg-purple-50 border-2 border-purple-300 rounded-lg p-4">
    <label className="block text-base font-bold text-purple-800 mb-2 flex items-center gap-2">
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        学期托管设置（日期范围）
    </label>
    <p className="text-sm text-purple-700 mb-3">设置学期托管的日期范围和学费</p>
    
    <!-- 学期学费设置 -->
    <div className="mb-4">
        <label className="block text-xs font-medium text-purple-700 mb-2">学期学费（元）</label>
        <div className="flex gap-2 mb-2">
            <button className="px-3 py-2 bg-purple-600 text-white rounded-lg">3800元</button>
            <button className="px-3 py-2 bg-purple-200 text-purple-700 rounded-lg">4200元</button>
            <button className="px-3 py-2 bg-purple-200 text-purple-700 rounded-lg">4800元</button>
        </div>
        <input type="number" placeholder="自定义学费金额" className="w-full px-3 py-2 border border-purple-300 rounded-lg" />
    </div>
    
    <!-- 学期日期选择 -->
    <div className="grid grid-cols-2 gap-3 mb-3">
        <div>
            <label className="block text-xs font-medium text-purple-700 mb-1">学期开始日期</label>
            <input type="date" className="w-full px-3 py-2 border border-purple-300 rounded-lg" />
        </div>
        <div>
            <label className="block text-xs font-medium text-purple-700 mb-1">学期结束日期</label>
            <input type="date" className="w-full px-3 py-2 border border-purple-300 rounded-lg" />
        </div>
    </div>
    
    <div className="text-sm text-purple-600 bg-purple-100 rounded-lg p-3">
        <p className="font-medium mb-1">学期托管说明：</p>
        <p>• 学期开始日期：学生入学日期</p>
        <p>• 学期结束日期：本学期最后一天</p>
        <p>• 系统将在学期结束后提醒续费</p>
    </div>
</div>
```

### 2. 学生列表展示
- **类型标识**: 紫色标签显示"学期"
- **费用显示**: 显示学期费用金额
- **续费日期**: 显示下次续费日期
- **状态样式**: 根据状态显示不同颜色标识

### 3. 续费提醒组件
- **标题**: "续费提醒"
- **开关控制**: 0天(已过期)/3天/7天 可选
- **列表展示**: 卡片式布局，显示学生信息和续费状态
- **空状态**: 暂无即将到期续费时显示友好提示

## 系统配置

### 1. 设置选项
- **启用续费提醒**: 默认开启
- **提前提醒天数**: 支持0天、3天、7天可选
- **滚动计算方式**: 默认采用滚动计算
- **学期学费设置**: 支持自定义默认学期费用

### 2. 数据存储
- **本地存储**: 使用localStorage存储设置
- **设置键名**: `systemSettings`
- **同步机制**: 支持多标签页同步和事件通知

## 录入与编辑

### 1. 学生录入流程
1. 点击"添加学生"按钮
2. 选择托管方式为"学期"
3. 填写基本信息（姓名、年级、班级等）
4. 设置学期费用（支持快捷选择和自定义输入）
5. 设置学期开始和结束日期
6. 系统自动计算续费日期

### 2. 学期费用设置
- **快捷按钮**: 提供3800元、4200元、4800元快捷选择
- **自定义输入**: 支持输入任意学期费用金额
- **系统默认**: 优先使用系统设置中的学期费用，默认3800元

### 3. 日期设置
- **学期开始**: 默认学生入学日期，支持手动修改为任意日期
- **学期结束**: 可自定义设置本学期最后一天，完全灵活设置
- **自定义范围**: 支持任意时间范围的学期设置，不受传统学期限制
- **自动计算**: 系统根据规则自动计算续费日期

### 4. 自定义学期时间设置
学期会员的核心优势之一就是支持**完全自定义的学期时间设置**，管理员可以根据实际需求灵活配置：

#### 设置方式
1. **添加学生时设置**: 在选择"学期"托管方式后，界面会显示学期日期设置区域
2. **编辑学生信息**: 随时修改现有学期学生的开始和结束日期
3. **批量调整**: 支持逐个学生调整学期时间

#### 设置界面
- **学期开始日期**: 日期选择器，默认为学生入学日期
- **学期结束日期**: 日期选择器，可设置为任意未来日期
- **实时预览**: 选择日期后立即显示学期时长信息

#### 灵活性特点
- **任意开始时间**: 不受传统9月或3月开学限制，可以从任意日期开始
- **任意结束时间**: 可以根据课程安排设置任意结束日期
- **短期学期**: 支持设置1个月、2个月等短期学期
- **长期学期**: 支持设置6个月、1年等长期学期
- **跨年度学期**: 支持从当年设置到次年的跨年度学期

#### 使用场景示例
- **暑期班**: 7月1日 - 8月31日（2个月）
- **秋季班**: 9月1日 - 1月31日（5个月）
- **春季班**: 2月1日 - 6月30日（5个月）
- **全年班**: 1月1日 - 12月31日（12个月）
- **短期集训**: 任意设置的短期集中培训

## 注意事项与最佳实践

### 1. 重要提醒
⚠️ **学期学生暂停后不会暂停计费**，因为费用已在缴费时确定
⚠️ **学期结束后必须重新缴费才能恢复服务**
⚠️ **按自然日计算**，包含周末和节假日
⚠️ **预付费模式**，需提前缴纳整学期费用

### 2. 操作建议
- 定期检查学期学生的续费日期
- 及时提醒家长续费，避免服务中断
- 关注系统自动发送的到期提醒
- 合理设置学期开始和结束日期

### 3. 常见问题

**Q: 学期和月托的主要区别是什么？**
A: 学期按学期计算费用，通常时间较长（4-5个月）；月托按自然月计算，时间较短（1个月）。两者都采用预付费模式，但计费周期不同。

**Q: 学期费用可以自定义吗？**
A: 可以，系统提供3800/4200/4800元快捷选项，也支持输入任意自定义金额。

**Q: 续费提醒可以关闭吗？**
A: 可以在系统设置中关闭续费提醒功能，关闭后将不再显示续费提醒。

**Q: 学期学生暂停后费用如何处理？**
A: 按照系统规则，学期学生暂停后剩余费用不退还，建议在暂停前合理安排续费时间。

**Q: 如何设置新学期开始日期？**
A: 可以在系统设置中配置`nextSemesterStartDate`，系统会优先使用此设置，否则按默认规则计算。

**Q: 学期会员可以自定义学期时间吗？**
A: 是的，学期会员支持完全自定义学期时间。在添加或编辑学期学生时，可以手动设置学期开始日期和结束日期，系统会根据您设置的日期范围进行学期管理。

## 相关功能入口
- **学生管理**: 添加、编辑、状态变更
- **考勤管理**: 签到记录、补签操作
- **系统设置**: 学期费用配置、提醒设置
- **缴费管理**: 缴费记录查看、状态管理

## 设置路径指引

### 如何设置学期时间
1. **进入学生管理界面**
   - 点击左侧菜单"学生管理"
   - 选择"添加学生"或编辑现有学生

2. **选择学期托管方式**
   - 在学生类型中选择"学期"
   - 系统会自动展开学期设置区域

3. **设置学期日期**
   - **学期开始日期**: 选择学生入学或课程开始日期
   - **学期结束日期**: 选择课程结束日期
   - 可以设置任意时间范围，完全灵活

4. **设置学期费用**
   - 选择预设费用（3800/4200/4800元）
   - 或输入自定义金额

5. **保存设置**
   - 点击"保存"按钮完成设置
   - 系统将根据设置自动管理学期时间

### 设置界面位置
学期时间设置位于学生录入/编辑表单中的**紫色"学期托管设置"区域**，包含：
- 学期学费选择器
- 学期开始日期选择器  
- 学期结束日期选择器
- 学期托管说明提示

---

*本说明基于系统当前实现整理，如有功能更新请以实际系统为准。*